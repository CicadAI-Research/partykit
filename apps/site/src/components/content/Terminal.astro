---
import { Code } from "astro:components";
import "../../styles/variables.scss";
---

<div id="terminal">
  <div id="terminal-tabs">
    <span>Add PartyKit to a new project</span>
    <!-- <span>Add to existing project</span> -->
    <!-- <Button variant="terminal-github" url="#">Fork on GitHub</Button> -->
  </div>

  <div id="terminal-console">
    <Code
      code={`// 1. Install with npm
npm install partykit

// 2. Write your code
import type * as Party from "partykit/server";

export default class Server implements Party.Server {
  count = 0;

  constructor(public room: Party.Room) {}

  onMessage(message: string, ws: Party.Connection) {
    // On any message, increment and broadcast
    this.room.broadcast((++this.count).toString(), []);
  }
}

// 3. Run locally
npx partykit dev server.ts

// 4. Listen + hit enter to increment. Try multiple terminals.
// Using https://github.com/vi/websocat
websocat 'ws://127.0.0.1:1999/party/default-room'

// 5. Deploy to the edge network
npx partykit deploy server.ts --name my-first-counter

// 6. Try it out
websocat 'wss://my-first-counter.{yourname}.partykit.dev/party/default-room'
`}
      lang="js"
      theme="dark-plus"
    />
  </div>
</div>

<style lang="scss">
  @import "../../styles/shared.scss";

  #terminal {
    grid-column: 1 / 3;
    position: relative;
    display: flex;
    flex-direction: column;
    gap: 2rem;
    margin: 0 -1rem 4rem -3rem;
    padding: 40px 0 0;
    border-radius: 0 var(--box-radius) var(--box-radius) 0;
    background: #1e1e1e; /* to match Code theme background */
    color: white;
    font-variation-settings: "wght" 300;
    box-shadow: var(--window-shadow);
  }

  @media (min-width: 760px) {
    #terminal {
      grid-column: 1 / 7;
      grid-row: 4 / 5;
      margin-right: 0;
      padding-bottom: 0;
      margin-bottom: 0;
    }
  }

  #terminal:before {
    content: " ";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 40px;
    background: rgba(255, 255, 255, 0.1);
    border-bottom: 0.5px solid rgba(255, 255, 255, 0.3);
  }

  #terminal #terminal-tabs {
    @include font-S();
    position: absolute;
    top: 0;
    left: 2rem;
    right: 0;
    height: 40px;
    padding-right: 0.5em;
    overflow: hidden;
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: center;
    flex-wrap: wrap;
  }

  #terminal #terminal-tabs span {
    line-height: 38px;
    padding: 2px 2rem 0;
    // cursor: pointer;
  }

  #terminal #terminal-tabs span + span {
    border-left: 0.5px solid rgba(255, 255, 255, 0.3);
    color: rgba(255, 255, 255, 0.5);
  }

  #terminal #terminal-tabs span + span:hover {
    color: inherit;
  }

  #terminal-console {
    font-family: monospace;
    line-height: 1.5;
    font-size: 80%;
    padding: 4rem 2rem 4rem 4rem;
  }
</style>
